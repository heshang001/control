<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: root/base/DomCacheRefresh.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: root/base/DomCacheRefresh.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 缓存刷新dom类 单例 全局唯一控制
 * @author create by heshang
 * */
base.DomCacheRefresh = class {
    constructor() {
        this.styleList = [];
        this.tempT = null;
        this.freshNum = 0;
        this.startFreshCount = 100;//开始刷新的上限，达到上线后立即刷新style
        this.delayMs = 20;//延迟刷新style的毫秒数
    }

    /**
     *  单例类的对象
     * */
    static get instance() {
        return this._instance || (this._instance = new base.DomCacheRefresh());
    }

    /**
     * 添加对象属性进缓存池
     * @param control 对象
     * @param key 属性名称 || hash列表
     * @param value 属性名称对应的属性值
     * */
    addStyle(control, key, value) {
        if (!this.styleList[control.guid]) {
            let style = {};
            for (let i in control.dom.style) {
                if (control.dom.style[i] &amp;&amp; typeof control.dom.style[i] != "function") {
                    style[i] = control.dom.style[i];
                }
            }
            this.styleList[control.guid] = {control: control, style: style};
        }
        if (typeof key === "string") {
            this.styleList[control.guid].style[key] = value;
        } else {
            for (let i in key) {
                this.styleList[control.guid].style[i] = key[i];
            }
        }

        this.startRefresh();
    }

    /**
     * 检测是否需要刷新 当需要刷新的缓存数量超过上线 或者小于定期刷新的事件间隔 执行刷新
     * */
    startRefresh() {
        this.freshNum++;
        if (this.freshNum >= this.startFreshCount) {
            this.fresh();
            return;
        }
        clearTimeout(this.tempT);
        this.tempT = setTimeout(function () {
            this.fresh();
        }.bind(this), this.delayMs);
    }

    /**
     * 刷新dom属性
     * */
    fresh() {
        this.freshNum = 0;
        clearTimeout(this.tempT);
        this.tempT = null;
        for (let i in this.styleList) {
            let control = this.styleList[i].control;
            let style = this.styleList[i].style;
            let str = JSON.stringify(style);
            str = str.replace(/\"/g, "");
            str = str.replace(/\{/g, "");
            str = str.replace(/\}/g, "");
            str = str.replace(/\,/g, ";");
            control.dom.style = str;
        }
        this.styleList = [];
    }
};
base.DomCacheRefresh._instance = null;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="base.ControlDisplayBase.html">ControlDisplayBase</a></li><li><a href="base.ControlEventBase.html">ControlEventBase</a></li><li><a href="base.ControlReflex.html">ControlReflex</a></li><li><a href="base.DomCacheRefresh.html">DomCacheRefresh</a></li><li><a href="base.EventCycle.html">EventCycle</a></li><li><a href="base.Handler.html">Handler</a></li><li><a href="control.Base.html">Base</a></li><li><a href="control.Box.html">Box</a></li><li><a href="control.Button.html">Button</a></li><li><a href="control.Input.html">Input</a></li><li><a href="control.Label.html">Label</a></li><li><a href="control.Radio.html">Radio</a></li><li><a href="utils.Dom.html">Dom</a></li></ul><h3>Global</h3><ul><li><a href="global.html#base">base</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue May 29 2018 12:01:59 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
