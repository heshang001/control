"use strict";var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var base={},control={},compents={},utils={},errlog={};base.Controller=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getItemById",value:function(e){return this.boxObj[e]}},{key:"setItemById",value:function(e,t){this.boxObj[e]=t}},{key:"delItemById",value:function(e){delete this.boxObj[e]}}]),e}(),base.Controller.boxObj={},base.EventPrope=function(){function e(){_classCallCheck(this,e),this.debugger=!0,base.EventPrope.control_un_id++,this._name="",this._version="0.0.1",this._author="",this._guid="control_"+base.EventPrope.control_un_id,this._tempDomStr="",this._width=100,this._height=50,this._style="",this._html="",this._visibility="visible",this._zindex=0,this._tabindex=0}return _createClass(e,[{key:"changeStyleStr",value:function(){}},{key:"setControllerItem",value:function(e,t){base.Controller.delItemById(e),base.Controller.setItemById(t,this),this.dom&&this.dom.setAttribute("data-guid",this._guid)}},{key:"tabindex",set:function(e){this._tabindex=e},get:function(){return this._tabindex}},{key:"dom",get:function(){return""}},{key:"html",get:function(){return this._html}},{key:"guid",get:function(){return this._guid},set:function(e){this.guid==e&&""==this.guid||(this.setControllerItem(this._guid,e),this._guid=e)}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}},{key:"version",get:function(){return this._version},set:function(e){this._version=e}},{key:"author",get:function(){return this._author},set:function(e){this._author=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}}]),e}(),base.EventPrope.control_un_id=0;var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}base.DomCacheRefresh=function(){function e(){_classCallCheck(this,e),this.styleList=[],this.tempT=null,this.freshNum=0,this.startFreshCount=100,this.delayMs=20}return _createClass(e,[{key:"addStyle",value:function(e,t,n){if(!this.styleList[e.guid]){var s={};for(var i in e.dom.style)e.dom.style[i]&&"function"!=typeof e.dom.style[i]&&(s[i]=e.dom.style[i]);this.styleList[e.guid]={control:e,style:s}}if("string"==typeof t)this.styleList[e.guid].style[t]=n;else for(var r in t)this.styleList[e.guid].style[r]=t[r];this.startRefresh()}},{key:"startRefresh",value:function(){this.freshNum++,this.freshNum>=this.startFreshCount?this.fresh():(clearTimeout(this.tempT),this.tempT=setTimeout(function(){this.fresh()}.bind(this),this.delayMs))}},{key:"fresh",value:function(){for(var e in this.freshNum=0,clearTimeout(this.tempT),this.tempT=null,this.styleList){var t=this.styleList[e].control,n=this.styleList[e].style,s=JSON.stringify(n);s=(s=(s=(s=s.replace(/\"/g,"")).replace(/\{/g,"")).replace(/\}/g,"")).replace(/\,/g,";"),t.dom.style=s}this.styleList=[]}}],[{key:"instance",get:function(){return this._instance||(this._instance=new base.DomCacheRefresh)}}]),e}(),base.DomCacheRefresh._instance=null,base.EventBase={CLICK:"click",DBLCLICK:"dblclick",MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",DRAGBEGIN:"dragbegin",DRAGMOVE:"dragmove",DRAGEND:"dragend",FCOURS:"fcours",LOAD_BEFORE:"loadbefore",LOAD_COMPLETE:"loadcomplete",CREATE_BEFORE:"createbefore",CREATE_COMPLETE:"createcomplete",DESTORY_BEFORE:"destorybefore",DESTORY_COMPLETE:"destorycomplete",CHANGE:"change",CONTEXTMENU:"contextmenu"};var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}base.Handler=function(){function s(e,t,n){_classCallCheck(this,s),this._tmp_call=e,this._tmp_caller=t,this._tmp_args=n,this.runIndex=0,this.stopIndex=0,this.call=e?this.runMine.bind(this):null,this.caller=t,this.args=n,this.handlerList=[]}return _createClass(s,[{key:"runMine",value:function(){this._tmp_call&&this._tmp_call.call(this._tmp_caller,this._tmp_args),this.runIndex=0,this.stopIndex=0,this.runHandlerList()}},{key:"stop",value:function(){this.stopIndex=this.runIndex,this.runIndex=this.handlerList.length}},{key:"resume",value:function(){this.runIndex=this.stopIndex,this.runHandlerList(),this.stopIndex=0}},{key:"runHandlerList",value:function(){if(this.runIndex<this.handlerList.length){var e=this.handlerList[this.runIndex],t=e.call,n=e.caller,s=e.args;t.call(n,t,n,s),this.runIndex++,this.runHandlerList()}}},{key:"next",value:function(e){return this.handlerList.push(e),this}}],[{key:"create",value:function(e,t,n){return new base.Handler(e,t,n)}}]),s}(),base.EventCycle=function(){function a(e,t,n,s,i,r){_classCallCheck(this,a),this.debugger=!1,this.parent=null,this.createBefore=e,this.createComplete=t,this.loadedBefore=n,this.loadedComplete=s,this.destoryBefore=i,this.destroyComplete=r}return _createClass(a,[{key:"getEvent",value:function(e){var t=null;switch(e){case base.EventBase.CREATE_BEFORE:t=this.createBefore;break;case base.EventBase.CREATE_COMPLETE:t=this.createComplete;break;case base.EventBase.LOAD_BEFORE:t=this.loadedBefore;break;case base.EventBase.LOAD_COMPLETE:t=this.loadedComplete;break;case base.EventBase.DESTORY_BEFORE:t=this.destoryBefore;break;case base.EventBase.DESTORY_COMPLETE:t=this.destroyComplete}return t}},{key:"runEvent",value:function(e,t){var n=this.getEvent(e);n&&n.call.call(n.caller,n.args,t),this.debugger&&console.log(this.parent.author+" "+this.parent.name+" "+this.parent.guid+" run code "+e+" fun complete")}},{key:"setEvent",value:function(e,t){switch(e){case base.EventBase.CREATE_BEFORE:this.createBefore=t;break;case base.EventBase.CREATE_COMPLETE:this.createComplete=t;break;case base.EventBase.LOAD_BEFORE:this.loadedBefore=t;break;case base.EventBase.LOAD_COMPLETE:this.loadedComplete=t;break;case base.EventBase.DESTORY_BEFORE:this.destoryBefore=t;break;case base.EventBase.DESTORY_COMPLETE:this.destroyComplete=t}}}]),a}();var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}base.ControlDisplayBase=function(_base$EventPrope){function _class(e){_classCallCheck(this,_class);var t=_possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).call(this));return t._eventCycle=e,t._childList=[],t._parent=null,t.type="",t._styleCache=base.DomCacheRefresh.instance,t.eventCycle.runEvent(base.EventBase.CREATE_BEFORE),t}return _inherits(_class,_base$EventPrope),_createClass(_class,[{key:"getChildAt",value:function(e){return this._childList[e]}},{key:"getChildById",value:function(e){for(var t in this.childList)if(this.childList[t].guid===e)return this.childList[t];return null}},{key:"reflexProp",value:function reflexProp(child,reflex){var guid=utils.Dom.getAttr(child,"guid"),text=utils.Dom.getAttr(child,"text"),config=utils.Dom.getAttr(child,"config");this.guid=guid||this.guid,text&&(this.text=text),config&&(this.config=eval(config)),this.reflexPropSelf(child,reflex)}},{key:"reflexPropSelf",value:function(e,t){}},{key:"reflexDom",value:function(e,t){this.reflexProp(e,t)}},{key:"addChild",value:function(e){this.eventCycle.runEvent(base.EventBase.LOAD_BEFORE),(e._parent=this)._childList.push(e),e.dom&&this.dom&&this.dom.appendChild(e.dom),e.setControllerItem(e.guid,e.guid),this.eventCycle.runEvent(base.EventBase.LOAD_COMPLETE)}},{key:"removeAllChild",value:function(){for(var e in this._childList)this._childList[e].destory();this._childList=null}},{key:"removeSelfUI",value:function(){this.parent&&this.parent.dom.removeChild(this.dom)}},{key:"destoryDisplayBase",value:function(){this.eventCycle.runEvent(base.EventBase.DESTORY_BEFORE),this.removeAllChild(),this.removeSelfUI(),this._parent=null,this.eventCycle.runEvent(base.EventBase.DESTORY_COMPLETE),this._eventCycle=null}},{key:"destorySelfProp",value:function(){}},{key:"destorySelf",value:function(){this.destorySelfProp()}},{key:"destory",value:function(){this.destorySelf(),this.destoryDisplayBase()}},{key:"loadComplete",value:function(){this.eventCycle.runEvent(base.EventBase.LOAD_COMPLETE)}},{key:"style",value:function(e,t){this._styleCache.addStyle(this,e,t)}},{key:"config",set:function(e){for(var t in e)void 0!==this[t]?this[t]=e[t]:this.debugger&&console.warn(this.type+" prop"+t+" is not defined")}},{key:"eventCycle",get:function(){return this._eventCycle||(this._eventCycle=new base.EventCycle),this._eventCycle.parent||(this._eventCycle.parent=this),this._eventCycle}},{key:"childList",get:function(){return this._childList}},{key:"dom",get:function(){return null}},{key:"parent",get:function(){return this._parent}},{key:"visibility",set:function(e){this.style("visibility",e),this._visibility=e},get:function(){return this._visibility}},{key:"zindex",set:function(e){this.style("zIndex",e),this._zindex=e},get:function(){return this._zindex}},{key:"width",set:function(e){this.style("width",e),this._width=e},get:function(){return this._width}}]),_class}(base.EventPrope);var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}base.ControlEventBase=function(_base$ControlDisplayB){function _class(e){_classCallCheck(this,_class);var t=_possibleConstructorReturn(this,(_class.__proto__||Object.getPrototypeOf(_class)).call(this,e));return t._eventList=[],t._event=[],t._stop=!1,t}return _inherits(_class,_base$ControlDisplayB),_createClass(_class,[{key:"getEvent",value:function(e,t){if(this._eventList[e])for(var n in this._eventList[e]){var s=this._eventList[e][n];s.call,s.caller,s.args;if(t.call==_call&&t.caller==_caller)return n}return-1}},{key:"onEvent",value:function(e,t){this._event[e]=t}},{key:"runEvent",value:function(e,t){if(this._event[e]){if(this._stop)return void(this._stop=!1);var n=this._event[e],s=n.call,i=n.caller,r=n.args;s&&s.call(i,t,r)}}},{key:"offEvent",value:function(e){delete this._event[e]}},{key:"on",value:function(e,t){-1==this.getEvent(e,t)&&(this._eventList[e]?this._eventList[e].push(t):this._eventList[e]=[t])}},{key:"off",value:function(e,t){var n=-1;if(this._eventList[e])for(var s in this._eventList[e])if(-1!=(n=this.getEvent(e,t)))break;0<=n&&delete this._eventList[e][n]}},{key:"once",value:function(e,t){this.on(e,function(){t.call&&t.call(t.caller,t.args),this.off(e,t)},this)}},{key:"dispatch",value:function(e,t,n){if(this._eventList[e]){if(this._stop)return void(this._stop=!1);for(var s in this._eventList[e]){var i=this._eventList[e][s],r=i.call,a=i.caller,o=i.args;n&&n!=a||r&&r.call(a,t,o)}}}},{key:"destorySelfEvent",value:function(){}},{key:"destorySelf",value:function(){this.destorySelfEvent(),this.destorySelfProp()}},{key:"destory",value:function(){this._event=null,this._eventList=null,this.destorySelf(),this.destoryDisplayBase()}},{key:"createReflexEvent",value:function createReflexEvent(str){return base.Handler.create(function(){eval(str)},this)}},{key:"reflexEvent",value:function(e,t){var n=utils.Dom.getEvt(e,"click"),s=utils.Dom.getEvt(e,"onload"),i=utils.Dom.getEvt(e,"change");n&&(this.click=this.createReflexEvent(n)),s&&t.ready(this.createReflexEvent(s)),i&&(this.change=this.createReflexEvent(i)),this.reflexEventDefault(e,t)}},{key:"reflexEventDefault",value:function(e,t){}},{key:"reflexDom",value:function(e,t){this.reflexProp(e,t),this.reflexEvent(e,t)}},{key:"stop",value:function(){this.parent&&this.parent instanceof base.ControlEventBase&&this.parent.pstop()}},{key:"pstop",value:function(){this._stop=!0,this.stop()}},{key:"click",set:function(e){this._stop?this._stop=!1:this.onEvent(base.EventBase.CLICK,e)},get:function(){return this._event[base.EventBase.CLICK]}},{key:"dblclick",set:function(e){this._stop?this._stop=!1:this.onEvent(base.EventBase.DBLCLICK,e)}},{key:"change",set:function(e){this._stop?this._stop=!1:this.onEvent(base.EventBase.CHANGE,e)}},{key:"contextmenu",set:function(e){this._stop?this._stop=!1:this.onEvent(base.EventBase.CONTEXTMENU,e)}},{key:"dragbegin",set:function(e){this._stop?this._stop=!1:this.onEvent(base.EventBase.DRAGBEGIN,e)}},{key:"dragmove",set:function(e){this._stop?this._stop=!1:this.onEvent(base.EventBase.DRAGMOVE,e)}},{key:"dragend",set:function(e){this._stop?this._stop=!1:this.onEvent(base.EventBase.DRAGEND,e)}}]),_class}(base.ControlDisplayBase);var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}base.ControlReflex=function(){function _class(){var t=this;_classCallCheck(this,_class),this.debugger=!1,this.call=null,this.caller=null,this.box=null,this._readyList=[],!(window.attachEvent&&!window.opera)?document.addEventListener("DOMContentLoaded",function(){t.init()},!1):document.onreadystatechange?document.onreadystatechange=function(e){"interactive"===document.readyState&&t.init()}:document.ready=function(){this.init()}.bind(this)}return _createClass(_class,[{key:"ready",value:function(e){this._readyList.push(e)}},{key:"init",value:function(){var e=new control.Box,t=document.body.cloneNode(!0);document.body.innerHTML="";for(var n=t.children,s=0;s<n.length;s++)this.build(n[s],e);this.box=e,document.body.appendChild(e.dom),this.runReadyList()}},{key:"runReadyList",value:function(){for(var e in this._readyList){var t=this._readyList[e],n=t.call,s=t.caller,i=t.args;n.call(s,this.box,i)}this._readyList=null}},{key:"startBuild",value:function(){}},{key:"build",value:function(e,t){if("SCRIPT"!==e.nodeName){var n=this.createControlAtt(e,t);this.buildChildren(e.children,n)}}},{key:"buildChildren",value:function(e,t){if(!(e.length<=0))for(var n=0;n<e.length;n++)this.build(e[n],t)}},{key:"checkReflex",value:function(e){return-1<e.indexOf("data-")||-1<e.indexOf("evt-")}},{key:"createControlAtt",value:function(e,t){for(var n=e.cloneNode(!1),s=this.makeControl(n),i=0;i<n.attributes.length;i++){var r=utils.Dom.getAttrNodeName(n.attributes[i]),a=utils.Dom.getAttrValue(n.attributes[i]);this.checkReflex(r)&&!this.debugger||s.dom.setAttribute(r,a)}return s.reflexDom(n,this),t.addChild(s),s}},{key:"makeControl",value:function makeControl(child){try{var type=utils.Dom.getAttr(child,"control-type");if(!type)return new control.Base(child);var a=eval("new "+type+"()");return a}catch(e){var error=new Error("reflex dom is Error："+utils.Dom.getOuterHtml(child));throw error.stack=e.stack,error}}}]),_class}(),base.reflex=new base.ControlReflex;var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}errlog.Error=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"throwError",value:function(e,t,n,s,i){var r=void 0,a=void 0,o=void 0,l=void 0;(r=$("<div></div>")).css({position:"absolute",width:"100%",height:"100%",top:0,left:0,backgroundColor:"black",opacity:.8,zIndex:999}),$("body").append(r),(a=$("<div></div>")).css({position:"absolute",width:"500px",height:"400px",top:"50%",left:"50%","border-radius":"30px",transform:"translate(-50%,-50%)",backgroundColor:"white",zIndex:999,overflow:"auto"}),(o=$("<div></div>")).text("错误提示⚠"),o.css({fontWeight:"bold",fontSize:"18px","text-align":"center",marginTop:"15px"}),a.append(o),l=$('<div style="font-size: 14px;padding:25px">\n                                <div>\n                                    <span>错误信息:</span>\n                                    <span style="color:red">'+e+'</span>\n                                </div>\n                                <div>\n                                    <span>错误堆栈:</span>\n                                    <span style="color:red">'+(i&&i.stack)+'</span>\n                                </div>\n                                <div>\n                                    <span>错误文件:</span>\n                                    <span style="color:red">'+t+'</span>\n                                </div>\n                                <div>\n                                    <span>错误行数:</span>\n                                    <span style="color:red">'+n+'</span>\n                                </div>\n                                <div>\n                                    <span>错误列数:</span>\n                                    <span style="color:red">'+s+"</span>\n                                </div>\n                            </div>"),a.append(l),$(function(){$("body").append(a),r.click(function(){r.remove(),a.remove()})})}}]),e}(),window.onerror=errlog.Error.throwError;var _createClass=function(){function s(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}utils.Dom=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getOuterHtml",value:function(e){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}},{key:"parseDom",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.children}},{key:"getAttrValue",value:function(e){return e.value}},{key:"getAttrNodeName",value:function(e){return e.nodeName}},{key:"getBasic",value:function(e,t,n){var s=t.getAttribute(e+n);return s||""}},{key:"getAttr",value:function(e,t){return this.getBasic("data-",e,t)}},{key:"getEvt",value:function(e,t){return this.getBasic("evt-",e,t)}},{key:"getEvl",value:function(e,t){return this.getBasic("evl-",e,t)}},{key:"removeAttr",value:function(e,t,n){e.removeAttribute(t+n)}}]),e}(),utils.Href=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getQureryString",value:function(e,t){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),s=(t=t?"?"+t.split("?")[1]:window.location.search).substr(1).match(n);return null!=s?s[2]:null}}]),e}(),utils.Ajax=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"post",value:function(e,t,n,s){$.ajax({url:e,type:"post",data:t,dataType:"json",success:n,error:s})}},{key:"postFormData",value:function(e,t,n,s){$.ajax({url:e,type:"POST",data:t,processData:!1,contentType:!1,success:n,error:s})}},{key:"get",value:function(e,t,n,s){$.ajax({url:e,type:"get",data:t,dataType:"json",success:n,error:s})}}]),e}();